<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="Apply_Info_Dtl_SQL">

	
	<select id="managerinfo" parameterType="hashmap" resultType="hashmap">
        SELECT name,regexp_replace(phone,'(.{3})(.+)(.{4})','\1-\2-\3') phone,email,addr,addr_dtl
        FROM EMP_ANNC EA
        JOIN C_MEMBER C
        ON (EA.MEM_NO = C.MEM_NO)
        JOIN C_INFO CI
        ON (C.CORP_NO = CI.CORP_NO)
        JOIN MEMBER M
        ON (M.MEM_NO = EA.MEM_NO)
        where mem_gbn = 2
        and ea.emp_no = #{empno}
        and ea.del_chk = 0
	</select>
	
	<select id="getinfo" parameterType="hashmap"
		resultType="hashmap">
		SELECT c_name, recruit_gbn, G.gradu,
		major, CG.carr, PG.pay_gbn, pay_low,
		pay_high, EG.emp_gbn,
		dtl, addr, addr_dtl, 
		TO_CHAR(REG_DATE,'YY/MM/DD') REG_DATE,
		TO_CHAR(DLINE,'YY/MM/DD') DLINE, 
		CASE 
	    WHEN TRUNC(SYSDATE)-TRUNC(DLINE) > 0 THEN 'D-'||TO_CHAR(TRUNC(SYSDATE)-TRUNC(DLINE))
	    WHEN TRUNC(SYSDATE)-TRUNC(DLINE) = 0 THEN 'D-DAY'
	    ELSE '마감'
	    END AS D_DAY,
		SECTOR_NAME,
		emp_title, POS, EMAIL,
		name,regexp_replace(phone,'(.{3})(.+)(.{4})','\1-\2-\3') phone
		FROM EMP_ANNC EA
		JOIN C_MEMBER C
		ON (EA.MEM_NO = C.MEM_NO)
		JOIN C_INFO CI
		ON (C.CORP_NO = CI.CORP_NO)
		JOIN MEMBER M
		ON (M.MEM_NO = EA.MEM_NO)
		JOIN SECTOR SEC
		ON (EA.SECTOR_NO = SEC.SECTOR_NO)
		JOIN (SELECT CAT_NAME GRADU,SCD_CAT FROM COMM_CODE WHERE FST_CAT = 7) G
		ON (EA.GRADU = G.SCD_CAT)
		JOIN (SELECT CAT_NAME EMP_GBN, SCD_CAT FROM COMM_CODE WHERE FST_CAT = 3)
		EG
		ON (EA.EMP_GBN = EG.SCD_CAT)
		JOIN (SELECT CAT_NAME PAY_GBN, SCD_CAT FROM COMM_CODE WHERE FST_CAT = 8)
		PG
		ON (EA.PAY_GBN = PG.SCD_CAT)
		JOIN (SELECT CAT_NAME CARR, SCD_CAT FROM COMM_CODE WHERE FST_CAT = 6) CG
		ON (EA.CARR = CG.SCD_CAT)
		where ea.del_chk = 0
		AND M.WDRAWL_DATE IS NULL
		and ea.emp_no = #{empNo}
	</select>

	<select id="getinfo_Cnt" parameterType="hashmap"
		resultType="Integer">
		SELECT COUNT(DISTINCT EA.EMP_NO) AS CNT
		FROM EMP_ANNC EA INNER JOIN C_MEMBER CM
		ON EA.MEM_NO = CM.MEM_NO
		INNER JOIN C_INFO CI
		ON CM.CORP_NO = CI.CORP_NO
		FULL OUTER JOIN(SELECT DISTINCT QUAL_NO,EMP_NO FROM EMP_QUAL) EQ
		ON EA.EMP_NO = EQ.EMP_NO
		WHERE DEL_CHK = 0
		<if test="searchTxt != null and searchTxt != ''">
			<if test="sectorNo != null and sectorNo != ''">
				AND SECTOR_NO = #{sectorNo}
			</if>
			<if test="startDate != null and startDate !=''">
				AND REG_DATE &gt;= #{startDate}
			</if>
			<if test="endDate != null and endDate != ''">
				AND DLINE &lt;= #{endDate}
			</if>

			<if test="region neq 16 and region != null and region !=''">
				AND REGION_NO = #{region}
			</if>
			<if test="sal != null and sal != ''">
				<choose>
					<when test="sal eq 0">
						AND PAY_GBN = '0'
					</when>
					<when test="sal eq 1 and minSal != null and minSal != ''">
						AND PAY_GBN = '1'
						AND PAY_LOW &gt;= #{minSal}
					</when>
					<when test="sal eq 1 and maxSal != null and maxSal != ''">
						AND PAY_GBN = '1'
						AND PAY_HIGH &lt;= #{maxSal}
					</when>
				</choose>
			</if>
			<if test="empGbn != null and empGbn != ''">
				AND EMP_GBN = #{empGbn}
			</if>
			<if test="gradu != null and gradu != ''">
				AND GRADU = #{gradu}  
			</if>
			<if test="qualno != null and qualno != ''">
			    AND QUAL_NO IN (${qualno}) 

			</if>
			<choose>
				<when test="searchGbn eq 0">
					AND CI.C_NAME LIKE '%' || #{searchTxt} || '%'
					OR
					EA.EMP_TITLE LIKE '%' || #{searchTxt} || '%'
				</when>
				<when test="searchGbn eq 1">
					AND CI.C_NAME LIKE '%' || #{searchTxt} || '%'
				</when>
				<when test="searchGbn eq 2">
					AND EA.EMP_TITLE LIKE '%' || #{searchTxt} || '%'
				</when>
			</choose>

		</if>




		<if test="sectorNo != null and sectorNo != ''">
			AND SECTOR_NO = #{sectorNo}
		</if>
		<if test="startDate != null and startDate !=''">
			AND REG_DATE &gt;= #{startDate}
		</if>
		<if test="endDate != null and endDate != ''">
			AND DLINE &lt;= #{endDate}
		</if>
		<if test="region neq 16 and region != null and region !=''">
			AND REGION_NO = #{region}
		</if>
		<if test="sal != null and sal != ''">
			<choose>
				<when test="sal eq 0">
					AND PAY_GBN = '0'
				</when>
				<when test="sal eq 1 and minSal != null and minSal != ''">
					AND PAY_GBN = '1'
					AND PAY_LOW &gt;= #{minSal}
				</when>
				<when test="sal eq 1 and maxSal != null and maxSal != ''">
					AND PAY_GBN = '1'
					AND PAY_HIGH &lt;= #{maxSal}
				</when>
			</choose>
		</if>
		<if test="carr != null and carr != ''">
			<choose>
				<when test="carr eq 0">
					AND CARR = '0'
				</when>
				<when test="carr eq 1">
					AND CARR = '1'
				</when>
				<when test="carr eq 2 and minCareer != null and minCareer !=''">
					AND CARR = '2'
					AND CARR_Y &gt;= #{minCareer}
				</when>
				<when test="carr eq 2 and maxCareer != null and maxCareer !=''">
					AND CARR = '2'
					AND CARR_Y &lt;= #{maxCareer}
				</when>
			</choose>
		</if>
		<if test="empGbn != null and empGbn != ''">
			AND EMP_GBN = #{empGbn}
		</if>
		<if test="gradu != null and gradu != ''">
			AND GRADU = #{gradu}
		</if>
		<if test="qualno != null and qualno != ''">
		    AND QUAL_NO IN (${qualno})
		</if>
	</select>

	<select id="getinfo_list" parameterType="hashmap"
		resultType="hashmap">
		SELECT E.EMP_NO, E.CORP_IMG, E.C_NAME, E.EMP_TITLE
		FROM (SELECT EA.EMP_NO, CI.CORP_IMG, CI.C_NAME, EA.EMP_TITLE,
        ROW_NUMBER() OVER(ORDER BY EA.EMP_NO DESC) AS ENUM
		FROM EMP_ANNC EA INNER JOIN C_MEMBER CM 
        ON EA.MEM_NO = CM.MEM_NO
		INNER JOIN C_INFO CI
        ON CM.CORP_NO = CI.CORP_NO 
        FULL OUTER JOIN(SELECT DISTINCT QUAL_NO,EMP_NO FROM EMP_QUAL) EQ
        ON EA.EMP_NO = EQ.EMP_NO
		WHERE EA.DEL_CHK = 0
		<if test="searchTxt != null and searchTxt != ''">
			<if test="sectorNo != null and sectorNo != ''">
				AND SECTOR_NO = #{sectorNo}
			</if>
			<if test="startDate != null and startDate !=''">
				AND REG_DATE &gt;= #{startDate}
			</if>
			<if test="endDate != null and endDate != ''">
				AND DLINE &lt;= #{endDate}
			</if>

			<if test="region neq 16 and region != null and region !=''">
				AND REGION_NO = #{region}
			</if>
			<if test="sal != null and sal != ''">
				<choose>
					<when test="sal eq 0">
						AND PAY_GBN = '0'
					</when>
					<when test="sal eq 1 and minSal != null and minSal != ''">
						AND PAY_GBN = '1'
						AND PAY_LOW &gt;= #{minSal}
					</when>
					<when test="sal eq 1 and maxSal != null and maxSal != ''">
						AND PAY_GBN = '1'
						AND PAY_HIGH &lt;= #{maxSal}
					</when>
				</choose>
			</if>
			<if test="empGbn != null and empGbn != ''">
				AND EMP_GBN = #{empGbn}
			</if>
			<if test="gradu != null and gradu != ''">
				AND GRADU = #{gradu}
			</if>
			<if test="qualno != null and qualno != ''">
			    AND QUAL_NO IN (${qualno})
			</if>

			<choose>
				<when test="searchGbn eq 0">
					AND CI.C_NAME LIKE '%' || #{searchTxt} || '%'
					OR
					EA.EMP_TITLE LIKE '%' || #{searchTxt} || '%'
				</when>
				<when test="searchGbn eq 1">
					AND CI.C_NAME LIKE '%' || #{searchTxt} || '%'
				</when>
				<when test="searchGbn eq 2">
					AND EA.EMP_TITLE LIKE '%' || #{searchTxt} || '%'
				</when>
			</choose>

		</if>


		<if test="sectorNo != null and sectorNo != ''">
			AND SECTOR_NO = #{sectorNo}
		</if>
		<if test="startDate != null and startDate !=''">
			AND REG_DATE &gt;= #{startDate}
		</if>
		<if test="endDate != null and endDate != ''">
			AND DLINE &lt;= #{endDate}
		</if>
		<if test="region neq 16 and region != null and region !=''">
			AND REGION_NO = #{region}
		</if>
		<if test="sal != null and sal != ''">
			<choose>
				<when test="sal eq 0">
					AND PAY_GBN = '0'
				</when>
				<when test="sal eq 1 and minSal != null and minSal != ''">
					AND PAY_GBN = '1'
					AND PAY_LOW &gt;= #{minSal}
				</when>
				<when test="sal eq 1 and maxSal != null and maxSal != ''">
					AND PAY_GBN = '1'
					AND PAY_HIGH &lt;= #{maxSal}
				</when>
			</choose>
		</if>
		<if test="carr != null and carr != ''">
			<choose>
				<when test="carr eq 0">
					AND CARR = '0'
				</when>
				<when test="carr eq 1">
					AND CARR = '1'
				</when>
				<when test="carr eq 2 and minCareer != null and minCareer !=''">
					AND CARR = '2'
					AND CARR_Y &gt;= #{minCareer}
				</when>
				<when test="carr eq 2 and maxCareer != null and maxCareer !=''">
					AND CARR = '2'
					AND CARR_Y &lt;= #{maxCareer}
				</when>
			</choose>
		</if>
		<if test="empGbn != null and empGbn != ''">
			AND EMP_GBN = #{empGbn}
		</if>
		<if test="gradu != null and gradu != ''">
			AND GRADU = #{gradu}
		</if>
		<if test="qualno != null and qualno != ''">
		    AND QUAL_NO IN (${qualno})
		</if>

		)E
		WHERE E.ENUM BETWEEN #{startCnt} AND #{endCnt}
	</select>
	<select id="getCNo" parameterType="hashmap" resultType="String">
		SELECT
		CORP_NO
		FROM EMP_ANNC EA
		JOIN C_MEMBER CI
		ON (EA.MEM_NO = CI.MEM_NO)
		WHERE EA.EMP_NO = #{empNo}
	</select>
	<select id="rating" parameterType="hashmap" resultType="hashmap">
		select to_char(TRUNC(avg(wlb))) WLB, to_char(TRUNC(avg(promo_poss))) PROMO,
		to_char(TRUNC(avg(c_cult))) CULTURE, to_char(TRUNC(avg(wfare_pay)))
		WFARE, to_char(TRUNC(avg(mgm))) MGM ,to_char(TRUNC(
		sum(wlb+promo_poss+c_cult+wfare_pay+mgm)/count(wlb)/5)) TOTAL
		from grade g join c_info ci on g.corp_no = ci.corp_no
		where g.corp_no = #{corpNo}
	</select>
	<update id="reviews" parameterType="hashmap">
		update emp_annc set 
		views = views + 1
		where emp_no = #{empNo}
	</update>
	<select id="getQualList" parameterType="hashmap" resultType="hashmap">
		SELECT Q.QUAL_NAME, Q.QUAL_NO
		FROM QUAL Q
		JOIN EMP_QUAL EQ
		ON (Q.QUAL_NO = EQ.QUAL_NO)
        JOIN EMP_ANNC EA
        ON (EQ.EMP_NO = EA.EMP_NO)
		WHERE EA.DEL_CHK = 0
		AND EA.EMP_NO = #{empNo}
	</select>
</mapper>